apiVersion: v1
kind: ConfigMap
metadata:
  name: opifex-config
  namespace: opifex-system
  labels:
    app: opifex
    component: config
    version: "1.0.0"
  annotations:
    opifex.io/description: "Opifex Framework Configuration"
    opifex.io/foundation: "158/158 L2O tests passing"
data:
  # Application Configuration
  app.yaml: |
    application:
      name: "Opifex Framework"
      version: "1.0.0"
      environment: "production"
      debug: false

    # L2O Configuration
    l2o:
      enabled: true
      max_iterations: 1000
      convergence_threshold: 1e-6
      gpu_enabled: true
      batch_size: 32
      learning_rate: 0.001

    # Neural Operators Configuration
    neural_operators:
      enabled: true
      architectures:
        - "fno"
        - "deeponet"
        - "pinn"
        - "unet"
      gpu_acceleration: true
      precision: "float32"

    # Database Configuration
    database:
      host: "postgres-service"
      port: 5432
      name: "opifex"
      ssl_mode: "require"
      pool_size: 20

    # Metrics Configuration
    metrics:
      enabled: true
      port: 8080
      path: "/metrics"
      interval: 30

    # Logging Configuration
    logging:
      level: "info"
      format: "json"
      output: "stdout"

  # Prometheus Configuration
  prometheus.yaml: |
    global:
      scrape_interval: 30s
      evaluation_interval: 30s

    scrape_configs:
      - job_name: 'opifex-api'
        static_configs:
          - targets: ['opifex-api:8080']
        metrics_path: '/metrics'
        scrape_interval: 30s

      - job_name: 'opifex-worker'
        static_configs:
          - targets: ['opifex-worker:8080']
        metrics_path: '/metrics'
        scrape_interval: 30s

      - job_name: 'opifex-l2o-optimizer'
        static_configs:
          - targets: ['opifex-l2o-optimizer:8080']
        metrics_path: '/metrics'
        scrape_interval: 30s

  # GPU Configuration
  gpu.yaml: |
    gpu:
      enabled: true
      runtime: "nvidia"
      device_plugin: "nvidia.com/gpu"
      memory_fraction: 0.8
      allow_growth: true

    cuda:
      version: "11.8"
      compute_capability: "7.0"

  # Security Configuration
  security.yaml: |
    security:
      tls:
        enabled: true
        cert_path: "/etc/ssl/certs"
        key_path: "/etc/ssl/private"

      authentication:
        enabled: true
        type: "jwt"
        secret_key_env: "JWT_SECRET"
        expiration: 3600

      authorization:
        enabled: true
        default_role: "user"
        admin_role: "admin"
